
<div class="questionaire">
  <div class="q1 page" style="display: flex; width: 100%; height: 100%;">
    <div class="first question" style="width: 33%;">page 1</div>
    <div class="second question" style="width: 33%;"></div>
    <div class="third question" style="width: 33%;"></div>
  </div>
  <div class="q2 page" style="display: none; width: 100%; height: 100%;">
    <div class="first question" style="width: 33%;">page 2</div>
    <div class="second question" style="width: 33%;"></div>
    <div class="third question" style="width: 33%;"></div>
  </div>
  <div class="q3 page" style="display: none; width: 100%; height: 100%;">
    <div class="first question" style="width: 33%;">page 3</div>
    <div class="second question" style="width: 33%;"></div>
    <div class="third question" style="width: 33%;"></div>
  </div>
  <div class="q4 page" style="display: flex; width: 100%; height: 100%;">
    <div class="first question" style="width: 33%;">page 1</div>
    <div class="second question" style="width: 33%;"></div>
    <div class="third question" style="width: 33%;"></div>
  </div>
  <div class="q5 page" style="display: none; width: 100%; height: 100%;">
    <div class="first question" style="width: 33%;">page 2</div>
    <div class="second question" style="width: 33%;"></div>
    <div class="third question" style="width: 33%;"></div>
  </div>
  <div class="q6 page" style="display: none; width: 100%; height: 100%;">
    <div class="first question" style="width: 33%;">page 3</div>
    <div class="second question" style="width: 33%;"></div>
    <div class="third question" style="width: 33%;"></div>
  </div>
  <div class="q7 page" style="display: flex; width: 100%; height: 100%;">
    <div class="first question" style="width: 33%;">page 1</div>
    <div class="second question" style="width: 33%;"></div>
    <div class="third question" style="width: 33%;"></div>
  </div>
  <div class="q8 page" style="display: none; width: 100%; height: 100%;">
    <div class="first question" style="width: 33%;">page 2</div>
    <div class="second question" style="width: 33%;"></div>
    <div class="third question" style="width: 33%;"></div>
  </div>
  <div class="q9 page" style="display: none; width: 100%; height: 100%;">
    <div class="first question" style="width: 33%;">page 3</div>
    <div class="second question" style="width: 33%;"></div>
    <div class="third question" style="width: 33%;"></div>
  </div>
  <div class="q10 page" style="display: none; width: 100%; height: 100%;">
    <div class="first question" style="width: 33%;">page 3</div>
    <div class="second question" style="width: 33%;"></div>
    <div class="third question" style="width: 33%;"></div>
  </div>
</div>
<p id="button1">CLICK HERE TO GO TO THE COOL PAGE</p>

 <p id="auth-token" style="display: none;"><%= form_authenticity_token %></p>

<script>
  const rawPages = document.querySelectorAll('.page')
  const pages = [];
  let currentPageIndex = 0;
  const answers = [];
  let nextPageIndex = currentPageIndex;
  rawPages.forEach((page, index) => {
    const temp_obj = new Object;
    temp_obj.html = page;
    temp_obj.index = index;
    temp_obj.q1 = page.querySelector('.first');
    temp_obj.q2 = page.querySelector('.second');
    temp_obj.q3 = page.querySelector('.third');
    temp_obj.questions = page.querySelectorAll('.question')
    if (index == 0) {
      temp_obj.displaying = true;
    } else {
      temp_obj.displaying = false;
    }
    pages.push(temp_obj)
  })

  const selectAnswer = () => {
    console.log(nextPageIndex)
    pages[nextPageIndex].questions.forEach((question) => {
      question.addEventListener('click', (event) => {
        // SPECIFY ANSWER
        answers[nextPageIndex] = event.target
        pages[nextPageIndex].questions.forEach((q) => {
          q.classList.remove('active-question');
        })
        question.classList.add('active-question');
      })
    })
  }

  const sendTheForm = () => {
    const form = document.createElement('form');
    form.method = 'post';
    form.action = '/answer';

    answers.forEach((answer,index) => {
      const hiddenField = document.createElement('input');
      hiddenField.name = `question${index}`
      hiddenField.value = answer
      form.appendChild(hiddenField);
    })

    const hiddenField1 = document.createElement('input');
    hiddenField1.name = 'authenticity_token'
    hiddenField1.value = document.getElementById('auth-token').innerText
    form.appendChild(hiddenField1)

    document.body.appendChild(form);
    form.submit();
  }

  const displayNext = (event) => {
    pages.forEach((page, index) => {
      if (page.displaying == true) {
        currentPageIndex = page.index;
        page.displaying = false;
        page.html.style.display = 'none';
      } else {
        page.html.style.display = 'none'
      }
    })
    nextPageIndex += 1;
    if (nextPageIndex > 9) {
      console.log('we reached the end')
      sendTheForm();
    } else {
      pages[nextPageIndex].html.style.display = 'flex'
      pages[nextPageIndex].displaying = true;
      selectAnswer();
    }
  }

  selectAnswer();
  document.querySelector('#button1').addEventListener('click', displayNext);
</script>
<style>
  .questionaire {
    width: 500px;
    height: 500px;
  }

  .active-question {
    border: 5px solid red;
  }
</style>
