<div class="container">

  <div class="section mb-5">
    <div class="col-12">
      <div class="card-origin text-center">
        <div>
          <img src="https://images.unsplash.com/photo-1499852771843-6693d72f906f?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=889&q=80" alt="yoga studio" class="card-vertical-cover">
        </div>
        <div class="avatar-show-position">
          <%= cl_image_tag @club.photo, class: "avatar-bordered-card" %>
        </div>
        <div class="card-bottom">
          <div class="card-info">
            <h3 class="club-card-name"><%= @club.name %></h3>
            <p>City: Amsterdam</p>
            <p><%= @club.description %> </p>
          </div>
          <div class="card-tags">
            <div class="row d-flex">
              <% @club.offers.each do |offer| %>
              <div class="col-4">
                <div class="tag"><%= offer.sport.name %></div>
              </div>
              <% end %>
            </div>
          </div>
          <% @membership = Membership.where(user_id: current_user.id, club_id: @club.id) %>
          <% if @membership == [] %>
          <%= simple_form_for [@club, @membership = Membership.new] do |f| %>
          <%= f.hidden_field :status, value: "Pending" %>
          <%= f.submit "Add to Memberships", class:"btn btn-confirm"%>
          <% end %>
          <% elsif @membership[0].status == "Member" %>
          <div class="alert alert-success">
            <p>You already are a member of this club!</p>
          </div>
          <% else %>
          <div class="alert alert-warning">
            <p>Your membership request is getting processed</p></div>
            <% end %>
          </div>
        </div>
      </div>
    </div>



    <div class="section">
      <div>
        <h3 style="text-align: center">Reviews</h3>
      </div>
      <% ratings = [] %>
      <% @club.reviews.each do |ra| %>
      <% ratings << ra.rating.to_i %>
      <% end %>
      <% if ratings.size != 0 %>
      <% rating = ratings.sum / ratings.size unless ratings.size == 0 %>
      <div style="text-align: center">Rating:
        <% rating.times do  %>
        <span><i class="fas fa-star"></i></span>
        <% end %>
      </div>
      <% end %>
    </div>


    <div class="section my-3">
      <h3 style="text-align: center" class="mt-3"><%= pluralize @club.reviews.size, "review" %></h3>

      <div class="row text-center">
        <% if @club.reviews.blank? %>
          <p>Be the first to leave a review for <%= @club.name %></p>
        <% else %>
          <% @club.reviews.each do |review| %>
        <div class="col-sm-12 col-md-6 col-lg-4">
          <div class="card-origin my-2">
            <div class="d-flex">
              <div class="text-review">
                <p class="ml-2"><strong>Name: </strong> <%= review.user.name %></p>
                <p class="ml-2"><strong>Comment: </strong><%= review.comment %></p>
                <p class="ml-2"><strong>Rating: </strong>
                  <% review.rating.times do  %>
                  <span><i class="fas fa-star"></i></span>
                  <% end %>
                </p>
              </div>
              <div class="user-av">
                  <%= cl_image_tag review.user.photo, class: "avatar-review-page" %>
              </div>
            </div>
          </div>
         </div>
        <% end %>
      <% end %>
      </div>
    </div>

    <div class="section">
      <h3 class="mt-5" style="text-align: center">Add a review</h3>
      <%= simple_form_for [ @club, Review.new ] do |f| %>
      <%= f.input :rating, collection: [ 1, 2, 3, 4, 5 ] %>
      <%= f.input :comment, as: :text %>
      <div style="text-align: center">
      <%= f.submit "Send the review", class: 'btn btn-confirm' %>
      </div>
      <% end %>
    </div>

</div>

