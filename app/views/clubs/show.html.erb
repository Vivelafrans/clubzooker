<div class="container">

  <div class="section mb-3 ">
    <div class="col-12 p-0">
      <div class="card-origin text-center">
        <div>
          <img src="https://images.unsplash.com/photo-1499852771843-6693d72f906f?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=889&q=80" alt="yoga studio" class="card-vertical-cover">
        </div>
        <div class="avatar-show-position">
          <%= cl_image_tag @club.photo, class: "avatar-bordered-card-show" %>
        </div>
        <div class="card-bottom">
          <div class="card-info">
            <h2 class="club-card-name"><%= @club.name %></h2>
          </div>
        <% @membership = Membership.where(user_id: current_user.id, club_id: @club.id) %>
      <% if current_user != @club.admin %>
      <% if @membership == [] %>
      <%= simple_form_for [@club, @membership = Membership.new] do |f| %>
      <%= f.hidden_field :status, value: "Pending" %>
      <%= f.submit "Add to Memberships", class:"btn btn-confirm"%>
      <% end %>
      <% elsif @membership[0].status == "Member" %>
      <div class="alert alert-success">
        <p>You already are a member of this club!</p>
      </div>
      <% else %>
      <div class="alert alert-warning">
        <p>Your membership request is getting processed</p></div>
        <% end %>
        <% end %>
        </div>
      </div>
    </div>
  </div>
  <div class="card-origin flexing p-3 mb-3">
    <div class="information align-content-between">
      <div class="section">
      <h3>Offered Sports</h3>
      <div class="card-tags mt-3">
        <div class="row d-flex">
          <% @club.offers.each do |offer| %>
          <div class="col-4">
            <div class="tag"><%= offer.sport.name %></div>
          </div>
          <% end %>
        </div>
      </div>
      </div>
      <div class="section">
      <h3 class="mt-5">Description</h3>
      <div>
        <p class="mt-3"><%= @club.description %> </p>
      </div>
      </div>
        <div class="section">
        <h3 class="mt-5">Get in Contact!</h3>
        <div class="d-flex justify-content-between align-items-center">
          <div class="admin text-center mt-3">
            <%= cl_image_tag @club.admin.photo, class: "avatar-bordered" %>
            <p><%= @club.admin.name %></p>
          </div>
          <% if current_user != @club.admin %>
          <div class="section">
            <%= simple_form_for [ @club, Room.new ] do |f| %>
            <%= f.submit "Send a Message", class: 'btn btn-confirm'%>
            <% end %>
          </div>
          <% end %>
        </div>
        </div>
      </div>
      <div class="round_card">
        <div
        id="map"
        style="width: 500px; height: 500px;"
        data-markers="<%= @marker.to_json %>" data-mapbox-api-key=<%= ENV['MAPBOX_API_KEY'] %>></div>
      </div>
    </div>

    <div class="card-origin mb-3 px-4">
      <div class="section">
        <div class="mt-4">
          <h3 style="text-align: center">Reviews</h3>
        </div>
        <% ratings = [] %>
        <% @club.reviews.each do |ra| %>
        <% ratings << ra.rating.to_i %>
        <% end %>
        <% if ratings.size != 0 %>
        <% rating = ratings.sum / ratings.size unless ratings.size == 0 %>
        <div style="text-align: center">Rating:
          <% rating.times do  %>
          <span><i class="fas fa-star"></i></span>
          <% end %>
        </div>
        <% end %>
      </div>


      <div class="section my-3">
        <h3 style="text-align: center" class="mt-3"><%= pluralize @club.reviews.size, "review" %></h3>

        <div class="row text-center">
          <% if @club.reviews.blank? %>
          <p>Be the first to leave a review for <%= @club.name %></p>
          <% else %>
          <% @club.reviews.each do |review| %>
          <div class="col-sm-12 col-md-6 col-lg-4">
            <div class="card-origin my-2">
              <div class="d-flex">
                <div class="text-review">
                  <p class="ml-2"><strong>Name: </strong> <%= review.user.name %></p>
                  <p class="ml-2"><strong>Comment: </strong><%= review.comment %></p>
                  <p class="ml-2"><strong>Rating: </strong>
                    <% review.rating.times do  %>
                    <span><i class="fas fa-star"></i></span>
                    <% end %>
                  </p>
                </div>
                <div class="user-av">
                  <%= cl_image_tag review.user.photo, class: "avatar-review-page" %>
                </div>
              </div>
            </div>
          </div>
          <% end %>
          <% end %>
        </div>
      </div>
    </div>

    <div class="section card-origin mb-3 p-3 text-center">
      <h3>Leave a Review</h3>
      <% @membership = Membership.where(user_id: current_user.id, club_id: @club.id) %>
      <% if @membership == [] %>
      <div class="section text-center">
        <div class="yellow_box">
          <p>Only Members can rate a Club...</p>
        </div>
      </div>
      <% elsif @membership[0].status == "Member" %>
      <div class="section">
        <h3 class="mt-5" style="text-align: center">Add a review</h3>
        <%= simple_form_for [ @club, Review.new ] do |f| %>
        <%= f.input :rating, collection: [ 1, 2, 3, 4, 5 ] %>
        <%= f.input :comment, as: :text %>
        <div style="text-align: center">
          <%= f.submit "Send the review", class: 'btn btn-confirm' %>
        </div>
        <% end %>
      </div>
      <% else %>
      <div class="section text-center">
        <div class="yellow_box mb-5">
          <p>Only Members can rate a Club...</p>
        </div>
      </div>
      <% end %>
    </div>

